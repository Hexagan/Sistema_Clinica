{% extends "base.html" %}

{% block title %}Solicitar Turno{% endblock %}

{% block content %}

<h2>Solicitar Turno</h2>

<form method="GET" action="/turnos/disponibles/">

    <!-- ESPECIALIDAD -->
    <div class="mb-3">
        <label class="form-label">Especialidad</label>
        <select id="especialidad-select" class="form-select">
            <option value="">Seleccione una especialidadâ€¦</option>
            {% for e in especialidades %}
                <option value="{{ e.id }}">{{ e.nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- PROFESIONAL -->
    <div class="mb-3">
        <label class="form-label">Profesional</label>
        <select id="profesional-select" name="profesional" class="form-select" disabled>
            <option value="">Cualquiera</option>
            {% for p in profesionales %}
                <option
                    value="{{ p.id }}"
                    data-especialidad="{{ p.especialidad.id }}"
                >{{ p.apellido }} {{ p.nombre }}</option>
            {% endfor %}
        </select>
    </div>

    <!-- Modalidad -->
    <div class="mb-3">
        <label>Modalidad:</label>
        <select name="modo" class="form-select">
            <option value="PRES">Presencial</option>
            <option value="TELE">Virtual</option>
        </select>
    </div>

    <button class="btn btn-primary mt-3" type="submit">Buscar Turnos</button>
</form>

<script>
document.addEventListener("DOMContentLoaded", function () {

    const espSelect = document.getElementById("especialidad-select");
    const profSelect = document.getElementById("profesional-select");

    // Guardamos TODAS las opciones originales una sola vez
    const opcionesOriginales = Array.from(profSelect.options);

    espSelect.addEventListener("change", () => {

        const espId = espSelect.value;

        // limpiamos profesionales
        profSelect.innerHTML = "";

        // siempre agregamos "Cualquiera"
        const opcionCualquiera = opcionesOriginales[0].cloneNode(true);
        profSelect.appendChild(opcionCualquiera);

        if (!espId) {
            profSelect.disabled = true;
            return;
        }

        profSelect.disabled = false;

        opcionesOriginales.forEach(opt => {
            if (!opt.dataset.especialidad) return;  // saltar "Cualquiera"

            if (opt.dataset.especialidad === espId) {
                profSelect.appendChild(opt.cloneNode(true));
            }
        });
    });
});
</script>

{% endblock %}
